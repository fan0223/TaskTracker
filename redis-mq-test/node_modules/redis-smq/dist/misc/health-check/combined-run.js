"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const __1 = require("../..");
const redis_smq_common_1 = require("redis-smq-common");
redis_smq_common_1.logger.setLogger(console);
const config = {
    logger: {
        enabled: false,
    },
    messages: {
        store: true,
    },
};
const producer = new __1.Producer(config);
const consumer = new __1.Consumer(config);
consumer.run();
const produce = (err) => {
    if (err)
        console.log(err);
    else {
        setTimeout(() => {
            const m = new __1.Message().setBody(Date.now()).setQueue(queue);
            producer.produce(m, produce);
        }, 1000);
    }
};
const queue = `queue_${Date.now()}`;
__1.QueueManager.createInstance(config, (err, queueManager) => {
    if (err)
        console.log(err);
    else {
        queueManager === null || queueManager === void 0 ? void 0 : queueManager.queue.create(queue, false, (err) => {
            if (err)
                console.log(err);
            else
                consumer.consume(queue, (msg, cb) => cb(), produce);
        });
    }
});
//# sourceMappingURL=combined-run.js.map