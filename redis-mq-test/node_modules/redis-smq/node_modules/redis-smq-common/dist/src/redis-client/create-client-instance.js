"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createClientInstance = void 0;
const types_1 = require("../../types");
const async_1 = require("../async/async");
const node_redis_v3_client_1 = require("./clients/node-redis-v3-client");
const ioredis_client_1 = require("./clients/ioredis-client");
const node_redis_v4_client_1 = require("./clients/node-redis-v4-client");
function getClient(config) {
    if (config.client === types_1.RedisClientName.REDIS) {
        return new node_redis_v3_client_1.NodeRedisV3Client(config.options);
    }
    if (config.client === types_1.RedisClientName.REDIS_V4) {
        return new node_redis_v4_client_1.NodeRedisV4Client(config.options);
    }
    return new ioredis_client_1.IoredisClient(config.options);
}
function createClientInstance(config, cb) {
    const client = getClient(config);
    client.once('ready', () => {
        async_1.async.waterfall([
            (cb) => client.updateServerVersion(cb),
            (cb) => client.loadScripts(cb),
        ], (err) => {
            if (err)
                throw err;
            else
                cb(null, client);
        });
    });
}
exports.createClientInstance = createClientInstance;
//# sourceMappingURL=create-client-instance.js.map