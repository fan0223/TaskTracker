"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.async = void 0;
const eachOf = (collection, iteratee, callback) => {
    if (collection.length) {
        let idx = 0;
        const iterate = () => {
            iteratee(collection[idx], idx, (err) => {
                idx += 1;
                if (err || idx >= collection.length)
                    callback(err);
                else
                    iterate();
            });
        };
        iterate();
    }
    else {
        callback();
    }
};
const eachIn = (collection, iteratee, callback) => {
    const keys = Object.keys(collection);
    if (keys.length) {
        let idx = 0;
        const iterate = () => {
            const key = keys[idx];
            iteratee(collection[key], key, (err) => {
                idx += 1;
                if (err || idx >= keys.length)
                    callback(err);
                else
                    iterate();
            });
        };
        iterate();
    }
    else
        callback();
};
const each = (collection, iteratee, callback) => {
    if (Array.isArray(collection))
        eachOf(collection, iteratee, callback);
    else
        eachIn(collection, iteratee, callback);
};
const waterfall = (tasks, callback) => {
    if (tasks.length) {
        let idx = 0;
        const exec = (err, ...args) => {
            idx += 1;
            if (err) {
                callback(err);
            }
            else if (idx < tasks.length) {
                if (args.length)
                    tasks[idx](...args, exec);
                else
                    tasks[idx](exec);
            }
            else if (args.length) {
                callback(null, args[0]);
            }
            else
                callback();
        };
        tasks[idx](exec);
    }
    else
        callback();
};
exports.async = {
    each,
    eachIn,
    eachOf,
    waterfall,
};
//# sourceMappingURL=async.js.map